{% extends "base.html" %}

{% block title %}داشبورد{% endblock %}

{% block header %}مرکز مدیریت و برنامه‌ریزی{% endblock %}

{% block content %}
<style>
  .tabs {
    display: flex;
    border-bottom: 1px solid #eee;
    margin-bottom: 1rem;
  }

  .tab-button {
    padding: 0.5rem 1rem;
    cursor: pointer;
    border: none;
    background: none;
    font-weight: bold;
    color: #666;
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .tab-button.active {
    color: black;
    border-bottom: 2px solid #007bff;
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  ul.task-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  ul.task-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #f0f0f0;
    font-size: 0.95rem;
  }

  .task-meta {
    font-size: 0.8rem;
    color: #888;
  }

  .status-label {
    font-size: 0.75rem;
    font-weight: bold;
    padding: 0.1rem 0.4rem;
    border-radius: 5px;
    display: inline-block;
    margin-right: 0.5rem;
  }

  .status.pending { background-color: #fff3cd; color: #856404; }
  .status.in_progress { background-color: #e0f7fa; color: #006064; }
  .status.done { background-color: #dcedc8; color: #33691e; }
  .status.cancelled { background-color: #f8d7da; color: #721c24; }
</style>

<div class="tabs">
  <button class="tab-button active" onclick="showTab(0)">پروژه‌های فعال</button>
  <button class="tab-button" onclick="showTab(1)">با تأخیر</button>
  <button class="tab-button" onclick="showTab(2)">بدون زمان‌بندی</button>
  <button class="tab-button" onclick="showTab(3)">نزدیک به موعد</button>
</div>

<div class="tab-content active">
  {% if active_projects %}
    <ul class="task-list">
      {% for project in active_projects %}
        <li>
          <a href="{{ url_for('projects.project_detail', project_id=project.id) }}">
            {{ project.client_name }} - {{ project.goal }}
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>پروژه فعالی یافت نشد.</p>
  {% endif %}
</div>

<div class="tab-content">
  {% if pending_razmkars %}
    <ul class="task-list">
      {% for rk in pending_razmkars %}
        <li>
          <a href="{{ url_for('razmkar.razmkar_detail', razmkar_id=rk.id) }}">
            <strong>{{ rk.project.client_name }} - {{ rk.project.goal }}</strong>: {{ rk.mission }}
          </a>
          <div class="task-meta">
            <span class="status-label {{ rk.status.name }}">{{ rk.status.value }}</span>
            {% if rk.due_date %}
              <span>  {{ rk.due_date | to_jalali | to_persian_number }}</span>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>ماموریت عقب‌افتاده‌ای یافت نشد.</p>
  {% endif %}
</div>

<div class="tab-content">
  {% if unscheduled_razmkars %}
    <ul class="task-list">
      {% for rk in unscheduled_razmkars %}
        <li>
          <a href="{{ url_for('razmkar.razmkar_detail', razmkar_id=rk.id) }}">
            <strong>{{ rk.project.client_name }} - {{ rk.project.goal }}</strong>: {{ rk.mission }}
          </a>
          <div class="task-meta">
            <span class="status-label {{ rk.status.name }}">{{ rk.status.value }}</span>
            <span>بدون تاریخ</span>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>همه‌ی ماموریت‌ها زمان‌بندی دارند.</p>
  {% endif %}
</div>

<div class="tab-content">
  {% if upcoming_razmkars %}
    <ul class="task-list">
      {% for rk in upcoming_razmkars %}
        <li>
          <a href="{{ url_for('razmkar.razmkar_detail', razmkar_id=rk.id) }}">
            <strong>{{ rk.project.client_name }} - {{ rk.project.goal }}</strong>: {{ rk.mission }}
          </a>
          <div class="task-meta">
            <span class="status-label {{ rk.status.name }}">{{ rk.status.value }}</span>
            <span>{{ rk.due_date | to_jalali | to_persian_number }}</span>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>هیچ ماموریتی در ۷ روز آینده وجود ندارد.</p>
  {% endif %}
</div>

<script>
  function showTab(index) {
    const tabs = document.querySelectorAll('.tab-content');
    const buttons = document.querySelectorAll('.tab-button');

    tabs.forEach((tab, i) => {
      tab.classList.toggle('active', i === index);
    });

    buttons.forEach((btn, i) => {
      btn.classList.toggle('active', i === index);
    });
  }
</script>
{% endblock %}
