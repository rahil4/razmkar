<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="csrf-token" content="{{ csrf_token() if csrf_token is defined else '' }}">
  <meta name="theme-color" content="#ffffff">
  <title>{% block title %}داشبورد{% endblock %}</title>

  <!-- Vazirmatn (وزیرمتن) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Utilities -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/util.css') }}">

  {% block extra_head %}{% endblock %}

  <style>
    /* فونت پایه */
    body{
      font:15px/1.6 "Vazirmatn","Vazir",system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Arabic","IRANSans",Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <div class="navbar-wrap">
    <div class="container navbar">
      <div class="brand"><a href="{{ url_for('projects.manage_projects') }}">رزمکار</a></div>

      {% set ep = request.endpoint or '' %}
      {% set is_manage   = (ep == 'projects.manage_projects') %}
      {% set is_week     = (ep in ['projects.planning_week_page','projects.planning_week_data']) %}
      {% set is_settings = (ep == 'projects.planning_settings_page') %}

      <button class="burger" type="button" onclick="document.getElementById('topnav').classList.toggle('open')">☰ منو</button>

      <nav id="topnav" class="nav">
        <a href="{{ url_for('projects.manage_projects') }}" class="{{ 'active' if is_manage else '' }}">مدیریت پروژه‌ها</a>
        <a href="{{ url_for('projects.planning_week_page') }}" class="{{ 'active' if is_week else '' }}">برنامه هفتگی</a>
        <a href="{{ url_for('projects.planning_settings_page') }}" class="{{ 'active' if is_settings else '' }}">تنظیمات</a>
      </nav>
    </div>
  </div>

  <!-- Page header + actions -->
  <div class="container">
    <div class="flex items-center justify-between wrap gap-3 mt-2">
      <h1 class="h1">{% block header %}عنوان صفحه{% endblock %}</h1>
      <div class="flex items-center gap-2 wrap">
        {% block actions %}{% endblock %}
      </div>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flex wrap gap-2 mt-2">
          {% for category, message in messages %}
            <div class="alert
                        {% if category=='success' %}alert-success{% endif %}
                        {% if category=='warning' %}alert-warning{% endif %}
                        {% if category=='danger'  %}alert-danger{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Main content -->
    <main class="mt-2 mb-3">
      {% block content %}{% endblock %}
    </main>
  </div>

  {% block extra_scripts %}{% endblock %}
  <script>
    // Helper: گرفتن CSRF از متا برای درخواست‌های AJAX
    window.getCsrfToken = function(){
      const m = document.querySelector('meta[name="csrf-token"]');
      return m ? m.getAttribute('content') : '';
    };
  </script>
</body>
</html>
